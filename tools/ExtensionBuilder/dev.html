<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pooiod7's Scratch extension maker</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap">
<script src="https://cdn.jsdelivr.net/npm/ace-builds@1.4.14/src-min/ace.js"></script>
<script src="https://pooiod7.neocities.org/markdown/scratchblocks.js"></script>
<style>
body{margin:0;font-family:'Inter',sans-serif;background:#fdfdfd;color:#222}
.top-bar{display:flex;align-items:center;padding:10px 20px;background:#fff;border-bottom:1px solid #ccc;box-shadow:0 2px 5px rgba(0,0,0,0.05)}
.icon{font-size:20px;margin-right:auto}
.top-bar button{margin-left:10px;padding:8px 14px;background:#f0f0f0;border:1px solid #ccc;border-radius:6px;cursor:pointer;transition:background .2s}
.top-bar button:hover{background:#e0e0e0}
.main{display:flex;height:calc(100vh - 52px)}
.sidebar{width:240px;border-right:1px solid #ccc;background:#fafafa;padding:10px;box-sizing:border-box;overflow-y:auto}
.sidebar button{display:block;width:100%;margin-bottom:10px;background:none;border:none;cursor:pointer;padding:0}
.sidebar .scratch3{font-size:14px}
.editor{flex:1;height:100%}
</style>
</head>
<body>
<div class="top-bar">
  <div class="icon">ðŸ”§ Pooiod7's Scratch extension maker</div>
  <button onclick="alert('hello')">Save</button>
  <button onclick="alert('hello')">Load</button>
  <button onclick="alert('hello')">Export</button>
  <button onclick="alert('hello')">Test</button>
  <button onclick="alert('hello')">Config</button>
</div>
<div class="main">
  <div class="sidebar" id="sidebar"></div>
  <div id="editor" class="editor"></div>
</div>
<script>
var editor=ace.edit("editor")
editor.setTheme("ace/theme/chrome")
editor.session.setMode("ace/mode/javascript")

var extension={
  "id":"extension1",
  "name":"extension 1",
  "color":"#0fbd8c",
  "libs":[
    {
      "url":"https://code.jquery.com/jquery-3.7.1.min.js",
      "embed":false
    }
  ],
  "unsandboxed":{
    "status":true,
    "message":"This extension must run unsandboxed"
  },
  "blocks":[
    {
      "id":"block1",
      "text":"Block 1 with an input [INPUT1]",
      "type":"COMMAND",
      "args":{
        "INPUT1":{
          "type":"STRING",
          "defaultValue":"\"Hello\"",
          "menu":"formats"
        }
      },
      "function":"(args, util) {\n  console.log(args);\n}"
    }
  ],
  "menus":{
    "formats":[
      {"text":"Video","value":"mp4"},
      {"text":"Audio","value":"mp3"}
    ],
    "linkTypeConvert":["url","uri"]
  },
  "constructor":""
}

console.log("Extension loaded:", extension)

function renderBlock(block){
  let text = block.text
  let color = extension.color
  if(block.args){
    for(const [argName, argInfo] of Object.entries(block.args)){
      let value = ""
      if(argInfo.type==="STRING"||argInfo.type==="TEXT"){
        if(argInfo.defaultValue){
          value=argInfo.defaultValue
        }else if(argInfo.menu){
          let menu=extension.menus[argInfo.menu]
          if(Array.isArray(menu)){
            if(typeof menu[0]==="object")value=menu[0].text
            else value=menu[0]
          }
        }
        text=text.replace(`[${argName}]`,`[${value}]`)
      }else if(argInfo.type==="NUMBER"){
        value=argInfo.defaultValue||""
        text=text.replace(`[${argName}]`,`(${value})`)
      }else if(argInfo.type==="BLOCK"){
        text=text.replace(`[${argName}]`,"{\n}")
      }
    }
  }
  if(!text.endsWith(`::${color}`))text+=` ::${color}`
  return text
}

let sidebar=document.getElementById("sidebar")
extension.blocks.forEach(block=>{
  let blockText=renderBlock(block)
  console.log("Rendering block:",blockText)
  let btn=document.createElement("button")
  let div=document.createElement("div")
  div.className="scratch3"
  div.textContent=blockText
  btn.onclick=()=>alert("hello")
  btn.appendChild(div)
  sidebar.appendChild(btn)
})

scratchblocks.init()
scratchblocks.module.renderMatching(".scratch2",{style:"scratch2"})
scratchblocks.module.renderMatching(".scratch3",{style:"scratch3"})
</script>
</body>
</html>
